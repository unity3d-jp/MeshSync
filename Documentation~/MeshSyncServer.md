# MeshSyncServer

A component to sync meshes/models editing in DCC tools into Unity in real time.  
This sync process is done via TCP/IP, allowing the use of DCC tools in separate machines.   
This connection can be configured in the server/port settings of the [MeshSync DCC Plugin](https://docs.unity3d.com/Packages/com.unity.meshsync.dcc-plugins@latest)
installed in the appropriate DCC tool.

# MeshSyncServer Properties

<img align="right" src="images/MeshSyncServer.png">

- **Auto Start**  

  |**Values** |**Description** |
  |:---       |:---|
  | On        | automatically start the server using the specified port.|
  | Off       | click **Start/Stop** button to start/stop the server manually.|

  > Caveat: in a public network, other users will have access to MeshSync as well when the server is running. 
  > For example: they may view our Unity screen.

- **Root Object**  
  Designate a **GameObject** as the root for objects generated by the sync process.  
  If empty, the objects will be created in the root. 

- **Sync Visibility, Sync Transform, etc.**  
  Settings for enabling/disabling the sync of the applicable properties.  

  > This can be used to confirm specific results, for example, unchecking **Sync Transform** will let us confirm
  > the physics simulation behavior in Play mode accurately.

  - **Update Mesh Colliders**  
    if enabled and the mesh is updated, MeshCollider properties will be updated as well.

  > Disabling **Sync Meshes** brings better performance, and is recommended if syncing meshes is not necessary, 
  > for example, when editing only the pose/animation.

- **Animation Interpolation**: sets the animation interpolation method.   

  |**Values** |**Description** |
  |:---       |:---|
  | Smooth    | smoothly interpolate animation curves.|
  | Linear    | do linear interpolation between neighboring animation keys.|
  | Constant  | disable interpolation.|

  > For use cases in film productions, "Constant" may be preferable to match 
  > the number of animation samples to the target framerate on the DCC side.


- **Keyframe Reduction**: performs keyframe reduction when importing animations.  
  - **Threshold**: the error tolerance.   
    Higher threshold means less number of keys and higher errors, and vice versa.   
  - **Erase Flat Curves**: delete curves that have no change (flat).
  
- **Z-Up Correction**  
  Specifies how to convert Z-Up to Y-Up for DCC tools 
  in which the coordinate system is Z-up (3ds Max, Blender, etc.)

  |**Values** |**Description** |
  |:---       |:---|
  | Flip YZ   | converts all vertices of Transform and Mesh to Y-up.|
  | Rotate X  | converts the root object's Transform to a Y-up by <br/>applying a -90 X axis rotation to the root object, <br/> leaving the mesh in Z-up.|

  > "Flip YZ" works better in most cases.   
  > For reference, Unity's standard FBX Importer does the equivalent of "Rotate X".

- **Sync Material List**  
  When enabled, changing an object's material in the Scene view will update the material list (see below),
  and other objects which use the previous material will be updated to use the new material.

- **Progressive Display**  

  |**Values** |**Description** |
  |:---       |:---|
  | On        | scene updates will be reflected while receiving data in real-time.|
  | Off       | updates will be reflected after all of the scene data is received.|

- **Material List**  
  Changing a material in this list will update objects using the previous material 
  to use the new material.

  Saving and loading materials lists can be done with **Import List** and **Export List** buttons.   

- **Animation Tweak** : various animation adjustments.
  - **Override Frame Rate**: change the frame rate.    
    This option changes the frame rate while keeping the key duration or the animation length.    

    > Tips: playing a 24 FPS animation without interpolation when targetting 60 FPS will cause jittery movements.   
    > Changing the animation to 120 FPS is one possible approach to mitigate it. 
     
  - **Time Scale**       
    - **Scale** applies time scaling. For example, applying 0.5 will double the speed.  
    - **Offset** adds an offset for the specified seconds.    
       For example, applying a scale of -1 and an offset of -5 to a 5 second animation will result in reverse playback.    
  - **Drop Keyframes**: drop keyframes.   
    If we apply **Step=2** to an animation with 30 keystrokes, then the odd frames will be removed and the animation will become 15 frames.   
    Similarly, if **Step=3**, then the animation will become 10 frames.
  
- **Export Assets**  
  Export meshes/materials into asset files, which can be reused in other scenes or projects.  
  Normally, meshes/materials synced using MeshSync only exist in the active scene.

# Others

- When there is a MeshSyncServer object in the scene in Unity, we can open the server's address:port in our browser to view the server's 
  Unity GameView via the browser (the default is [127.0.0.1:8080](http://127.0.0.1:8080)).  
  If a message is sent from the browser's message form, that message will appear in Unity's Console. This communication method can be useful when Unity and the DCC tool are being used by different people. 

  ![GameViewInBrowser](images/GameViewInBrowser.png)


# Caveats

- Necessary MeshSync assets are automatically created in *StreamingAssets/MeshSyncServerRoot*.
  These files should be left as they are.

- Although this package is designed to be used in the Editor, model syncing will still work in runtime as well, but not the animations.  
**For performance reasons, make sure that syncing is not executed in the final build, unless it is required.**

